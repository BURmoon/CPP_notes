## 1 事务的特性

- 事务4大特性(ACID) ：原子性、一致性、隔离性、持久性

  - 原子性 (Atomicity)：事务中的全部操作在数据库中是不可分割的，要么全部完成，要么均不执行
  - 一致性 (Consistency)：几个并行执行的事务, 其执行结果必须与按某一顺序串行执行的结果相一致
  - 隔离性 (Isolation)：事务的执行不受其他事务的干扰，当数据库被多个客户端并发访问时，隔离它们的操作，防止出现脏读、幻读、不可重复读
  - 持久性 (Durability)：对于任意已提交事务，系统必须保证该事务对数据库的改变不被丢失，即使数据库出现故障

- 事务的起始标志：oracle中自动开启事务，以DML语句为开启标志

  事务的结束标志: 提交、回滚都是事务的结束标志
  - 显示提交：commit
  - 隐式提交：有DDL语句、正常退出(exit / quit)
  - 显示回滚: rollback
  - 隐式回滚: 掉电、宕机、非正常退出

## 2 控制事务

- 保存点（savepoint）可以防止错误操作影响整个事务，方便进行事务控制
- savepoint主要用于在事务上下文中声明一个中间标记, 将一个长事务分隔为多个较小的部分, 防止出错和丢失
- 如果保存点设置名称重复，则会删除之前的那个保存点
- 一但commit之后，所有的savepoint将失效

## 3 隔离级别

> 对于同时运行的多个事务, 当这些事务访问数据库中相同的数据时, 如果没有采取必要的隔离机制, 就会导致各种并发问题

- 脏读：对于两个事物 T1, T2

  T1 读取了已经被 T2 更新但还没有被提交的字段之后, 若 T2 回滚, T1读取的内容就是临时且无效的

- 不可重复读：对于两个事物 T1, T2

  T1 读取了一个字段, T2 更新了该字段后, T1再次读取同一个字段, 值就不同

- 幻读：对于两个事物 T1, T2

  T1 从一个表中读取了一个字段, T2 在该表中插入了一些新的行之后, 如果 T1 再次读取同一个表, 就会多出几行

