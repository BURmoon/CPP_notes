## 1 makefile

> makefile的优点就是自动化编译

- makefile文件的命名：makefile或者Makefile

- makefile的基本规则

  |	目标: 依赖		|

  |	（tab）命令	|

  - 目标：要生成的目标文件
  - 依赖：目标文件由哪些文件生成
  - 命令：通过执行该命令由依赖文件生成目标

-  make的参数

  - “-n”	--仅输出执行过程中的命令序列，但并不执行

> makefile的基本原则
>
> 若想生成目标, 检查规则中的所有的依赖文件是否都存在
>
> - 如果有的依赖文件不存在, 则向下搜索规则
> - 如果所有依赖都存在, 检查规则中的目标是否需要更新

## 2 makefile中的变量

- 普通变量

  - 定义变量：=

    `foo = abc		//定义变量并赋值`

  - 使用变量值：$(变量名)

    `bar = $(foo)	//使用变量`

- makefile提供的变量

  - CPPFLAGS	--C预处理的选项 -I
  - CFLAGS		--C编译器的选项 -Wall -g -c
  - LDFLAGS 		--链接器选项 -L  -l

- 自动变量

  > 自动变量只能在规则的命令中使用
  - $@	--表示规则中的目标
  - $<	--表示规则中的第一个条件
  - $^	--表示规则中的所有条件, 组成一个列表, 以空格隔开, 如果这个列表中有重复的项则消除重复项

- 模式规则

  - %	--表示一个或多个, 在依赖条件中同样可以使用%, 依赖条件中的%的取值取决于其目标

## 3 makefile函数

- wildcard	查找指定目录下的指定类型的文件

  ```
  src=$(wildcard *.c)		//找到当前目录下所有后缀为.c的文件,赋值给src
  等价于 src=main.c fun1.c fun2.c sum.c
  ```

- patsubst	匹配替换

  ```
  obj=$(patsubst %.c,%.o, $(src))		//把src变量里所有后缀为.c的文件替换成.o
  等价于 obj=main.o fun1.o fun2.o sum.o
  ```

## 4 makefile的清理操作

- make clean：执行clean对应的命令

  - 如果当前目录下有同名clean文件，则不执行clean对应的命令，需要进行伪目标声明

    `.PHONY:clean`

  - 声明目标为伪目标之后，makefile将不会检查该目标是否存在或者该目标是否需要更新

- clean命令中的特殊符号

  - “-”	--此条命令出错,make也会继续执行后续的命令

    `-rm -f	--强制执行, 若要删除的文件不存在使用-f不会报错`

